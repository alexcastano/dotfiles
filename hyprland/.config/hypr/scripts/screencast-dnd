#!/bin/bash
# Disable notifications during screen sharing
# Listens to Hyprland's socket2 for screencast events and toggles mako's do-not-disturb mode
# Preserves user's manual DND state

SOCKET="$XDG_RUNTIME_DIR/hypr/$HYPRLAND_INSTANCE_SIGNATURE/.socket2.sock"
STATE_FILE="/tmp/screencast-dnd-state"

while read -r line; do
    case "$line" in
        screencast\>\>1,*)
            # Screen sharing started - enable DND if not already enabled
            if ! makoctl mode | grep -q "do-not-disturb"; then
                dnd-toggle --enable
                touch "$STATE_FILE"
            fi
            ;;
        screencast\>\>0,*)
            # Screen sharing stopped - only disable DND if we enabled it
            if [[ -f "$STATE_FILE" ]]; then
                dnd-toggle --disable
                rm -f "$STATE_FILE"
            fi
            ;;
    esac
done < <(socat -U - UNIX-CONNECT:"$SOCKET")
